{% extends 'base.html' %}
{% block title %}Case Settings{% endblock %}

{% block addToHead %}
<script>
    var currUser = {{g.current_user.user_id}};
    var currCaseID = {{ case.case_id }}
</script>{% endblock %}

{% block content %}
<h1><a href = "../cases/{{ case.case_id }}">{{ case.case_name }}</a></h1>
<div class='col-lg-4'>
    <h1>Users</h1>
    
    <table id='user-table' class="table">
        <tr>
            <th></th>
            <th>Name</th>
            <th>Email</th>
        </tr>
        
        {% for user in users %}
        <tr id="User_{{ user.user_id }}">
            {% if user.user_id == owner.user_id %}
                <td class='case-user'><span class='glyphicon glyphicon-star'></span></td>
            {% else %}
                <td class='case-user'><button type="button" id={{ user.user_id }} class="close remove-user-x" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button></td>
            {% endif %}
            <!--case name-->
            <td>{{ user.fname }} {{ user.lname }}</td>
            <td>{{ user.email }}</td>
        </tr>
        {% endfor %}
    
    </table>
    
    <p><br/><span class='glyphicon glyphicon-star'></span> denotes case owner</p>
    
    <textarea id="new_users_input" class='settings-input' placeholder="JaneD@email.com, JohnD@email.com"></textarea></br>
    <button id='add_users'>Add new users</button>

    <h1>Tags</h1>
    
    <table id='tags-table' class="table">
        <tr>
            <th></th>
            <th>Tag</th>
            <th></th>
        </tr>
        {% for tag in tags %}
            <tr id="Tag_{{ tag.tag_id }}">
                {% if tag.case_id == case.case_id|int %}
                    <td><button type="button" id={{ tag.tag_id }} class="close remove-tag-x" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button></td>
                {% else %}
                    <td></td>
                {% endif %}
                <!--case name-->
                <td>{{ tag.tag_name }}:</td>
                <td>
                    <button class="tag-download" type="button" id='downloadClips' value='{{ tag.matching_clips }}'>
                        <span>
                        Download {{ tag.tag_name }} clips ({{ tag_counts[tag.tag_name] }})</span>
                    </button>
                </td>
                <td>
                    <button class="tag-download" type="button" id='createDeck' value='{{ tag.matching_clips }}'>
                        <span>
                        Create {{ tag.tag_name }} Deck ({{ tag_counts[tag.tag_name] }})</span>
                    </button>
                </td>
            </tr>
        {% endfor %}
    </table>


    <textarea id="new_tags_input" placeholder="Mock Trial, Appeal, Arbitration" class='settings-input'></textarea></br>
    <button id='add_tags'>Add new tags</button>

</div>

<div class='col-lg-8' id='case-messages'>
    <h1>Case messages</h1>
    <textarea id='new-message' class='settings-input mess-window' placeholder='Send team message'></textarea>
</br>
    <button id='send-message'>Send</button>
    <div id='all-messages' class='mess-window'>
        {% for mess in case_mess %}
            <div class='case-mess' aria-label="Close" id="div_{{mess.mess_id}}">
                {% if mess.user_id == g.current_user.user_id %}
                    <button class='mess-remove close' id={{mess.mess_id}}><span aria-hidden="true">&times;</span></button>
                {% endif %}
                <strong>{{ mess.user.fname }} {{ mess.user.lname }}</strong>
            </br>
                {{ mess.text }}
            </div>
        {% endfor %}
    </div>
</div>

<!--SOCKET IO CHAT-->
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script src='../static/js/sockets.js'></script>
<script src='../static/js/socketMessage.js'></script>

<!--Get a current time stamp for file naming-->
<script src='../static/js/getCurrTime.js'></script>
<!--adding/removing tags/downloading clips by tag-->
<script src='../static/js/tags.js'></script>
<!--Adding/deleting users-->
<script src='../static/js/caseUsers.js'></script>

{% endblock %}