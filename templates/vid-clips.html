{% extends 'base.html' %}
{% block title %}Case List{% endblock %}

{% block addToHead %}
<script>var typeOfVid = "clip"</script>
   
{% endblock %}

{% block content %}
<h1><a href = "../cases/{{ main_vid.case.case_id }}">{{ main_vid.case.case_name }}</a>: {{ main_vid.vid_name }}</span></h1>
<p><a href='/case-settings/{{ main_vid.case.case_id}}'>Case Dashboard</a></p>
<a href="/show-video/{{ main_vid.vid_id }}" target='_blank'><button>Show video</button></a>
<a href="/trim-video/{{ main_vid.vid_id }}"><button>Trim new clips</button></a>
<div id='alerts'><div class="alert alert-success alert-dismissable" id="success-message"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Success!</strong> Your request has been sent.</div></div>
<input type="text" id="table-search" onkeyup="filterTable(8)" placeholder="Search...">
<table data-toggle="table" class="table table-sortable" id="clip-table">
    <tr>
        <th><input type='checkbox' class='cbox' id="select-all"></th>
        <th onclick="sortTable(1)">Clip name <span class='glyphicon glyphicon-sort'></span></th>
        <th onclick="sortTable(2)">Duration<span class='glyphicon glyphicon-sort'></span></th>
        <th onclick="sortTable(3)" >Start <span class='glyphicon glyphicon-sort'></span></th>
        <th onclick="sortTable(4)">End <span class='glyphicon glyphicon-sort'></span></th>
        <th onclick="sortTable(5)">Status <span class='glyphicon glyphicon-sort'></span></th>
        <th onclick="sortTable(6)">Created by <span class='glyphicon glyphicon-sort'></span></th>
        <th>Tags <span class='glyphicon glyphicon-sort'></span></th>
    </tr>
    {% for clip in clips %}
    <tr>
        <td><input type='checkbox' class='vidcheck' value={{ clip.clip_id }}></td>
        <!-- list value first for sorting purposes-->
        <td><a value="{{ clip.clip_name }}"  href = '/show-clip/{{ clip.clip_id }}' target='_blank'>{{ clip.clip_name }}</a></td>
        <td>{{ clip.duration }}</td>
        
        <td>{{ clip.start_at }}</td>
        
        <td>{{ clip.end_at }}</td>
        
        <td>{% if clip.clip_status == 'Processing' %}
                <span class='clip-processing' id='{{clip.clip_id}}_Status'>
                    {{ clip.clip_status }}
                </span>
            {% else %}
                {{ clip.clip_status }}
            {% endif %}
        </td>
        
        <td>{{ clip.user.fname }} {{ clip.user.lname }}</td>
        
        <td id='tagtd_{{ clip.clip_id }}'>
            {% for ct in clip.clip_tags %}
                <button class="tag-btn cbox" value='{{ ct.tag.tag_id }}_{{ clip.clip_id }}' id='{{ ct.tag.tag_id }}_{{ clip.clip_id }}'>{{ ct.tag.tag_name }}<i class="case-user glyphicon glyphicon-remove"></i></button>
            {% endfor %}
        </td>
        
        <td><select id='sel_{{ clip.clip_id }}'>
                <option value="None">Select tag</option>
                {% for tag in tags %}
                  <option value="{{ tag.tag_id }}">{{ tag.tag_name }}</option>
                {% endfor %}
            </select>
            <button class='casetag' id='{{ clip.clip_id }}'>Add</button>
        </td>
    </tr>
    {% endfor %}
</table>
<button type="button" id='stitchClips' value="Stitch">Combine and Download Clips</button>
<button type="button" id='downloadClips' value="Download">Download Clips</button>
<button type="button" id='deleteClips' value="Delete">Delete Clips</button>
<button type="button" id='createDeck' value="Deck">Create slide deck</button>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script src='../static/js/sockets.js'></script>

<script>

$('#alerts').hide()

var successAlert = '<div class="alert alert-success alert-dismissable fade in" id="success-message"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Success!</strong> Your request has been sent.</div>'



function showAlert() {
    $("#alerts").show();
    setTimeout(function () {
       $("#alerts").fadeOut()
        }, 3000);
}


</script>

<script src="{{url_for ('static', filename='js/getCurrTime.js') }}"></script>

<script src="{{url_for ('static', filename='js/tags.js') }}"></script>

<script src="{{url_for ('static', filename='js/tableSort.js') }}"></script>
{% endblock %}