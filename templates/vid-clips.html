{% extends 'base.html' %}
{% block title %}Case List{% endblock %}

{% block addToHead %}
<script>
    var typeOfVid = "clip";
    var vidID = {{ main_vid.vid_id }};
</script>

{% endblock %}

{% block content %}
<div class='case-banner'>
    <h1 class='case-name'>
        <a href = "../cases/{{ main_vid.case.case_id }}">{{ main_vid.case.case_name }}</a>
        <i class="fa fa-cog case-gear" aria-hidden="true"></i>
        <i class="fa fa-comments-o case-gear" aria-hidden="true"></i> 
    </h1>
</div>
<div class='accent-bar'></div>
<p><a href='/case-settings/{{ main_vid.case.case_id}}'>Case Dashboard</a></p>

<div id='alerts'><div class="alert alert-success alert-dismissable" id="success-message"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Success!</strong> Your request has been sent.</div></div>

<!--clip handlers-->
<a href="/trim-video/{{ main_vid.vid_id }}"><button class='gray-btn med-btn'>Trim new clips</button></a>

<button type="button" id='stitchClips' value="Stitch" class='clear-btn small-btn'>
    <svg class="vidclip-handler" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 32.81"><title>download_stitch</title><path d="M15,23a1.41,1.41,0,0,1-1.4-1.36C13.08,5.38,3.51,2.8,3.41,2.77A1.41,1.41,0,0,1,4.09,0c.48.12,11.74,3.14,12.29,21.51A1.41,1.41,0,0,1,15,23Z"/><polygon points="10.7 20.42 15 27.66 19.12 20.32 10.7 20.42"/><path d="M15,23h0a1.41,1.41,0,0,1-1.36-1.45C14.17,3.19,25.43.16,25.91,0a1.41,1.41,0,0,1,.69,2.73c-.41.11-9.68,2.75-10.17,18.87A1.41,1.41,0,0,1,15,23Z"/><polygon points="10.88 20.32 15 27.66 19.3 20.42 10.88 20.32"/><path d="M30,32.81H0V23a1.41,1.41,0,0,1,2.81,0v7H27.19V23A1.41,1.41,0,0,1,30,23Z"/></svg>
</button>
<!--download individual files-->
<button type="button" id='downloadClips' value="Download" class='clear-btn small-btn'>
    <svg class="vidclip-handler" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 32.81"><title>download</title><path d="M30,32.81H0V23a1.41,1.41,0,0,1,2.81,0v7H27.19V23A1.41,1.41,0,0,1,30,23Z"/><path d="M15,23a1.41,1.41,0,0,1-1.41-1.41V1.41a1.41,1.41,0,0,1,2.81,0V21.6A1.41,1.41,0,0,1,15,23Z"/><polygon points="10.79 20.37 15 27.66 19.21 20.37 10.79 20.37"/></svg></button>
<!--delete btn-->
<button type="button" id='deleteClips' value="Delete" class='clear-btn small-btn'><svg class="vidclip-handler" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 27.1 30"><title>delete</title><path d="M25.4,6.29h-4.6V2.42A2.42,2.42,0,0,0,18.39,0H8.71A2.42,2.42,0,0,0,6.29,2.42V6.29H1.69a1.69,1.69,0,0,0,0,3.39H2.9v17.9H3A2.49,2.49,0,0,0,5.46,30H21.64a2.49,2.49,0,0,0,2.48-2.42h.08V9.68H25.4a1.69,1.69,0,0,0,0-3.39ZM9.19,25.65a1.45,1.45,0,0,1-2.9,0V12.58a1.45,1.45,0,0,1,2.9,0Zm5.81,0a1.45,1.45,0,0,1-2.9,0V12.58a1.45,1.45,0,0,1,2.9,0Zm5.81,0a1.45,1.45,0,0,1-2.9,0V12.58a1.45,1.45,0,0,1,2.9,0ZM9.19,4.35A1.45,1.45,0,0,1,10.65,2.9h5.81A1.45,1.45,0,0,1,17.9,4.35V6.29H9.19Z"/></svg></button>

<button type="button" id='createDeck' value="Deck" class='clear-btn small-btn'>
    <svg class="vidclip-handler" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 41.36 30.78"><title>make_deck</title><path d="M41.36,26H38.63a.39.39,0,1,1,0-.78h1.94V.78h-35V2.68a.39.39,0,0,1-.78,0V0H41.36Z"/><path d="M39,28.38H36.08a.39.39,0,0,1,0-.78h2.09V3.19h-35v2a.39.39,0,1,1-.78,0V2.4H39Z"/><path d="M36.55,30.78H0V4.8H36.55ZM.78,30h35V5.59H.78Z"/><path d="M17.41,24.9a2.06,2.06,0,0,0-1.23-1.64c-1.12-.45-3.89-1.42-3.89-1.42A2.42,2.42,0,0,1,10,23.29a2.42,2.42,0,0,1-2.28-1.45s-3.09,1-4.21,1.42A2.06,2.06,0,0,0,2.29,24.9Z"/><path d="M12.29,21.84A2.42,2.42,0,0,1,10,23.29a2.42,2.42,0,0,1-2.28-1.45v-1.6h4.56Z"/><path d="M10.3,11.38c3.15,0,2.82,5,2.82,5a26.38,26.38,0,0,1-.11,3.2c-.14.48-1.12,2.42-3,2.42s-2.82-1.94-3-2.42A26.38,26.38,0,0,1,7,16.4s-.33-5,2.82-5Z"/><path d="M7,16.43a.64.64,0,0,0-.4-.21c-.25,0-.36.37-.18.71s.25.41.18.63.09.51.4.37C7,17.24,7,16.57,7,16.43Z"/><path d="M13.54,16.22a.67.67,0,0,0-.42.23c0,.17,0,.81,0,1.47.33.16.49-.15.42-.36s0-.3.18-.63S13.8,16.22,13.54,16.22Z"/><path d="M13,16.54l.19,0a9.78,9.78,0,0,1,.14-1.88c.09-.54.13-1.47-.24-1.8a.31.31,0,0,0,.15-.27,2.27,2.27,0,0,0-.6-.69c-.27-.2-.86-.14-1-.44.09-.11.24-.08.35-.17a3,3,0,0,0-1.37-.06c-.16,0-.32.16-.47.19s-.29,0-.43,0a1.37,1.37,0,0,0,.35-.28,2.07,2.07,0,0,0-.75,0c-.23,0-.49,0-.71.07a2,2,0,0,0-.4.34,3.47,3.47,0,0,1-.66.36,1.16,1.16,0,0,0-.62.63,3.9,3.9,0,0,0-.32,1,1.41,1.41,0,0,0,0,.43c0,.17.06.4.09.6a2.45,2.45,0,0,1,.11.48c0,.2-.11.3-.11.48A3.21,3.21,0,0,0,7,16.68c0-.28.08-.92.09-1.2a1.84,1.84,0,0,1,.1-.83c.11-.21.32-.34.44-.54s.19-.57.46-.37a.18.18,0,0,0,0,.08c.26.2.39.29.7.21a4.85,4.85,0,0,1,.61-.22c.21,0,.15,0,.32.11a3.11,3.11,0,0,0,1.41.29,1.88,1.88,0,0,0,.93,0,1.26,1.26,0,0,1-.23-.35c.19.1.43,0,.6.12s.23.56.46.68C12.73,14.78,12.9,16.1,13,16.54Z"/><rect x="19.12" y="10.35" width="14.79" height="2.21"/><rect x="19.12" y="14.17" width="5.96" height="2.21"/><rect x="19.12" y="19.2" width="14.79" height="2.21"/><rect x="19.12" y="23.02" width="9.96" height="2.21"/></svg>
</button>

<!--clip table-->
<input type="text" id="table-search" onkeyup="filterTable(8)" placeholder="Search clips...">
<h2>Clips for <a href="/show-video/{{ main_vid.vid_id }}" target='_blank'>{{ main_vid.vid_name }}</a></h2>
<table data-toggle="table" class="table table-responsive" id="clip-table">
    <tr>
        <th><input type='checkbox' class='cbox' id="select-all"></th>
        <th onclick="sortTable(1)">Clip name <span class='glyphicon glyphicon-sort'></span></th>
        <th onclick="sortTable(2)" class='hidden-sm hidden-xs'>Duration<span class='glyphicon glyphicon-sort'></span></th>
        <th onclick="sortTable(3)" >Start <span class='glyphicon glyphicon-sort'></span></th>
        <th onclick="sortTable(4)">End <span class='glyphicon glyphicon-sort'></span></th>
        <th onclick="sortTable(5)" class='hidden-sm hidden-xs'>Status <span class='glyphicon glyphicon-sort'></span></th>
        <th onclick="sortTable(6)" class='hidden-sm hidden-xs'>Created by <span class='glyphicon glyphicon-sort'></span></th>
        <th>Tags <span class='glyphicon glyphicon-sort'></span></th>
        <th></th>
    </tr>
    {% for clip in clips %}
    <tr>
        <td><input type='checkbox' class='vidcheck' value={{ clip.clip_id }}></td>
        <!-- list value first for sorting purposes-->
        <td><a value="{{ clip.clip_name }}"  href = '/show-clip/{{ clip.clip_id }}' target='_blank'>{{ clip.clip_name }}</a></td>
        <td class='hidden-sm hidden-xs'>{{ clip.duration }}</td>
        
        <td>{{ clip.start_at }}</td>
        
        <td>{{ clip.end_at }}</td>
        
        <td class='hidden-sm hidden-xs'>{% if clip.clip_status == 'Processing' %}
                <span class='clip-processing' id='{{clip.clip_id}}_Status'>
                    {{ clip.clip_status }}
                </span>
            {% else %}
                {{ clip.clip_status }}
            {% endif %}
        </td>
        
        <td class='hidden-sm hidden-xs'>{{ clip.user.fname }} {{ clip.user.lname }}</td>
        
        <td id='tagtd_{{ clip.clip_id }}'>
            {% for ct in clip.clip_tags %}
                <button class="tag-btn cbox" value='{{ ct.tag.tag_id }}_{{ clip.clip_id }}' id='{{ ct.tag.tag_id }}_{{ clip.clip_id }}'>{{ ct.tag.tag_name }}<i class="case-user glyphicon glyphicon-remove close tag-close"></i></button></br>
            {% endfor %}
        </td>
        
        <td><select id='sel_{{ clip.clip_id }}'>
                <option value="None">Select tag</option>
                {% for tag in tags %}
                  <option value="{{ tag.tag_id }}">{{ tag.tag_name }}</option>
                {% endfor %}
            </select>
            <button class='casetag gray-btn small-btn' id='{{ clip.clip_id }}'>Add</button>
        </td>
    </tr>
    {% endfor %}
</table>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script src='../static/js/sockets.js'></script>

<script>

$('#alerts').hide()

var successAlert = '<div class="alert alert-success alert-dismissable fade in" id="success-message"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a><strong>Success!</strong> Your request has been sent.</div>'

</script>

<script src="{{url_for ('static', filename='js/collectChecks.js') }}"></script>

<script src="{{url_for ('static', filename='js/showAlert.js') }}"></script>

<script src="{{url_for ('static', filename='js/getCurrTime.js') }}"></script>

<script src="{{url_for ('static', filename='js/tags.js') }}"></script>

<script src="{{url_for ('static', filename='js/table_sort.js') }}"></script>
{% endblock %}